!/bin/bash
DIR=$(dirname "$0")
printf '\e[1;40;92m'
clear

cd $DIR

# Use find to locate the .xcodeproj file
xcodeproj_file=$(find . -name "*.xcodeproj" -print -quit)

# Check if a .xcodeproj file was found
if [ -n "$xcodeproj_file" ]; then
    xcodeproj_name=$(basename "$xcodeproj_file" .xcodeproj)
else
    echo "No .xcodeproj file found."
    # Close the Terminal window
    osascript -e 'tell application "Terminal" to close window 1' & exit
fi

# Ask the user a question
result=$(osascript -e 'display dialog "Upload to Website?" buttons {"Yes", "No"} default button "Yes"')
if [[ "$result" == *"No"* ]]; then
    # Close the Terminal window
    osascript -e 'tell application "Terminal" to close window 1' & exit
fi

localhost=/usr/local/var/www
if [ -n "$xcodeproj_file" ]; then
    zip_file=$(cat .www)
else
    zip_file="$xcodeproj_file.zip"
fi

platform="macos"

echo "Archiving for $platform"
rm $localhost/downloads/$platform/hp/$zip_file

zip $localhost/downloads/$platform/hp/$zip_file bin/* -r -x "*/.DS_Store"
zip $localhost/downloads/$platform/hp/$zip_file pplib/* -x "*/.DS_Store"
zip $localhost/downloads/$platform/hp/$zip_file hpprgm/* -x "*/.DS_Store"

cd $localhost
./sync.sh

# Close the Terminal window
osascript -e 'tell application "Terminal" to close window 1' & exit
